#!/bin/bash

function do_cmd {
    echo $@
    $@
    
    if [ "$?" -ne "0" ]; then
        echo "*** ERROR ***"
        exit
    fi
}

# Clear the screen
/usr/bin/osascript -e 'tell application "System Events" to tell process "Terminal" to keystroke "k" using command down'

# Any argument triggers skipping of actual build step (only do the copying)
if [ -z $1 ]; then
    # Build and reobfuscate
    do_cmd cd ~/work/forge/mcp
    do_cmd ./recompile.sh
    do_cmd ./reobfuscate.sh
fi

# Copy the texture resources to the compiled mod's folder
function CopyTextures {
    do_cmd mkdir -p ~/work/forge/mcp/reobf/minecraft/pdunham/$1/textures
    do_cmd rm -f ~/work/forge/mcp/reobf/minecraft/pdunham/$1/textures/*png
    do_cmd cp    ~/work/minecraft_mods/mods/pdunham/$1/textures/*png ~/work/forge/mcp/reobf/minecraft/pdunham/$1/textures/
}

# Copy the sound resources to the compiled mod's folder
function CopySounds {
    do_cmd mkdir -p ~/work/forge/mcp/reobf/minecraft/pdunham/$1/textures
    do_cmd rm -f ~/work/forge/mcp/reobf/minecraft/pdunham/$1/textures/*png
    do_cmd cp    ~/work/minecraft_mods/mods/pdunham/$1/textures/*png ~/work/forge/mcp/reobf/minecraft/pdunham/$1/textures/
}

# Zip of the mod so we can use it in the minecraft/mods folder
function ZipMod {
    zip=$1
    do_cmd cd ~/work/forge/mcp/reobf/minecraft/
    do_cmd zip -r ${zip} pdunham/$2
}

# Copy the mod to the various local destinations
function CopyModLocalClient {
    do_cmd cp $1 ~/ftb/YogCraft/minecraft/mods/
    do_cmd cp $1 ~/Desktop/
}

function CopyModLocalServer {
    do_cmd cp $1 ~/Desktop/MineCraft/FeedTheBeast/MindCrack/minecraft/mods/
    do_cmd cp $1 ~/Desktop/MineCraft/YogCraft_Server/mods/
}

# Copy the mod to Ian's machine
function CopyModIan {
    do_cmd cp $1 /Volumes/Users/Ian/Documents/Weird/
}

# Update the Texture resources
CopyTextures 'weird'
CopySounds   'weird'

ZipMod 'weirdBlock.zip' 'weird*'
CopyModLocalServer 'weirdBlock.zip'
CopyModLocalClient 'weirdBlock.zip'


echo "Successs"
echo
