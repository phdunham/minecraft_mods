#!/bin/bash

function do_cmd {
    echo $@
    $@
    
    if [ "$?" -ne "0" ]; then
        echo "*** ERROR ***"
        exit
    fi
}

# Clear the screen
/usr/bin/osascript -e 'tell application "System Events" to tell process "Terminal" to keystroke "k" using command down'

# Any argument triggers skipping of actual build step (only do the copying)
if [ -z $1 ]; then
    # Build and reobfuscate
    do_cmd cd ~/work/forge/mcp
    do_cmd ./recompile.sh
    do_cmd ./reobfuscate.sh
fi

# Update the Texture resources
do_cmd mkdir -p ~/work/forge/mcp/reobf/minecraft/pdunham/weird/textures
do_cmd rm -f ~/work/forge/mcp/reobf/minecraft/pdunham/weird/textures/*png
do_cmd cp    ~/work/minecraft_mods/mods/pdunham/weird/textures/*png ~/work/forge/mcp/reobf/minecraft/pdunham/weird/textures/

# Update the Sound resources
do_cmd mkdir -p ~/work/forge/mcp/reobf/minecraft/pdunham/weird/sounds/baby
do_cmd rm -f ~/work/forge/mcp/reobf/minecraft/pdunham/weird/sounds/baby/*ogg
do_cmd cp    ~/work/minecraft_mods/mods/pdunham/weird/sounds/baby/*ogg ~/work/forge/mcp/reobf/minecraft/pdunham/weird/sounds/baby/

# Make the zip file
zip=weirdBlock.zip
do_cmd cd ~/work/forge/mcp/reobf/minecraft/
do_cmd zip -r ${zip} pdunham/

# Copy the mod to the client and server
do_cmd cp ${zip} ~/ftb/YogCraft/minecraft/mods/
do_cmd cp ${zip} ~/Desktop/MineCraft/FeedTheBeast/MindCrack/minecraft/mods/
do_cmd cp ${zip} ~/Desktop/MineCraft/YogCraft_Server/mods/
do_cmd cp ${zip} ~/Desktop/

# Copy the mod to Ian's machine
# do_cmd rm /Volumes/Users/Ian/Desktop/FTB/Direwolf20/minecraft/mods/${zip}
# do_cmd cp ${zip} /Volumes/Users/Ian/Desktop/FTB/Direwolf20/minecraft/mods 
# # Copying files w/ spaces is messed up
# set "${zip}" "/Volumes/Users/Ian/Documents/Game Folders/Minecraft/Yogcraft server FTB/mods/"
# echo cp $@
# rm "$@"
# cp "$@${zip}"
# 
echo "Successs"
echo